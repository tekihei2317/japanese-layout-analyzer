# CLIツールの作成

コーパスと配列の組み合わせについて、評価指標を計算するためのコマンドを作ります。

最終的には色々な機能を追加して、CLIツールとして配列制作に役立てられるようにしたいです。

## タスク一覧

- [ ] 各指標の計算方法を、genkeyやoxeylizerを参考に調べる
- [ ] コーパスのフォーマットを決める。各指標を計算できるようなデータが必要。
- [ ] コーパスと配列を指定して、指標を表示するコマンドを作る
- [ ] コマンドに、Webサイトで使うためのJSON形式のフォーマットでエクスポートするオプションを付ける

## CLIの設計

コマンド名は`jla`（japanese-layout-analyzerの略）とします。

機能一覧

- ひらがなのテキストを読み込み、コーパスに変換する
- コーパスと配列を指定して、各種指標を計算する

### コマンド一覧

- テキストからコーパス生成
- 評価
  - ひらがなのテキストで評価
  - テキストで評価
  - テキスト形式またはJSONでの出力

```text
# コーパスと配列を指定して分析
jla analyze <corpus> <layout> [--format <text|json>]

# テキストファイルと配列を指定して分析
jla analyze <file> <layout> [--format <text|json>]

# 配列の一覧を表示
jla layout list

# 配列の詳細を表示
jla layout show <layout>

# テキストファイルからコーパス生成
jla corpus build <file.txt>

# コーパスの一覧を表示
jla corpus list

# コーパスの詳細を表示
jla corpus show <corpus>

# コーパスのngramを出力←まぁファイル見たら分かるか...
jla corpus ngram <corpus> [--n <2|3>] [--count <number>]

# 指標の上位リストを表示
jla sfbs <corpus> <layout> [--count <number>]
jla sfss <corpus> <layout> [--count <number>]
jla scissors <corpus> <layout> [--count <number>]
```

### コーパスの形式

TODO: ひらがな→ストロークの変換方法と一緒に考える

### 指標の形式

テキスト形式と、JSON形式の2つがあります。JSON形式は、WebUIで使用するために必要です。

#### テキスト形式

参考に、genkeyとoxeylyzerの出力を確認します。

genkey

```text
$ ./genkey analyze qwerty
QWERTY
q w e r t  y u i o p [ ] \
a s d f g  h j k l ; '
z x c v b  n m , . /
Rolls (l): 19.53%
        Inward: 9.66%
        Outward: 9.87%
Rolls (r): 18.31%
        Inward: 10.69%
        Outward: 7.62%
Alternates: 26.81%
Onehands: 2.83%
Redirects: 13.36%
Finger Speed (weighted): [0.34 0.43 10.74 10.22 10.21 1.00 3.20 0.27]
Finger Speed (unweighted): [0.50 1.53 51.56 56.19 56.13 4.79 11.54 0.40]
Highest Speed (weighted): 10.74 (LM)
Highest Speed (unweighted): 56.19 (LI)
Index Usage: 21.7% 18.8%
SFBs: 5.250%
DSFBs: 9.642%
LSBs: 5.51%
Top SFBs:
        ed 0.971%       de 0.679%       ce 0.560%       ec 0.433%
        lo 0.427%       un 0.380%       tr 0.368%       rt 0.342%

Worst Bigrams:
        ec 121.931      un 62.668       ed 42.876       rt 37.855
        ol 32.229       rb 25.755       rv 21.451       um 20.087

Score: 115.58
```

oxeylyzer

配列の文字が赤色のグラデーションで表示されて、ヒートマップになっている。

```text
$ oxeylyzer
> language english
"english"
Set language to english. Sfr: 2.74%
> analyze qwerty
qwerty
q w e r t  y u i o p
a s d f g  h j k l ;
z x c v b  n m , . /
Sfb:  6.604%
Dsfb: 11.238%
Finger Speed: 62.295
    [0.762, 1.248, 19.165, 16.881, 15.537, 2.136, 6.462, 0.103]
Scissors: 2.026%
Lsbs: 4.199%
Pinky Ring Bigrams: 1.685%

Inrolls: 20.173%
Outrolls: 16.829%
Total Rolls: 37.002%
Onehands: 2.779%

Alternates: 19.503%
Alternates (sfs): 6.828%
Total Alternates: 26.331%

Redirects: 6.022%
Redirects Sfs: 5.703%
Bad Redirects: 0.424%
Bad Redirects Sfs: 1.008%
Total Redirects: 13.158%

Bad Sfbs: 5.339%
Sft: 0.431%

Score: -6.800
```

Alt Keyboard Layout（Discord）のBotの出力

Botの名前はcmini。コンパクトでわかりやすい出力。

```text
> !cmini view qwerty
QWERTY (cmini) (0 likes)
  q w e r t  y u i o p [ ] \
   a s d f g  h j k l ; '
    z x c v b  n m , . /

MT-QUOTES:
  Alt: 19.31%
  Rol: 38.43%   (In/Out: 20.62% | 17.81%)
  One:  2.31%   (In/Out:  1.03% |  1.28%)
  Rtl: 40.74%   (In/Out: 21.65% | 19.09%)
  Red:  6.07%   (Bad:     0.37%)

  SFB:  5.84%
  SFS: 12.67%   (Red/Alt: 6.68% | 5.98%)

  LH/RH: 54.42% | 45.58%
```

#### JSON形式

TODO:

## 各指標の計算方法について

TODO:

まず、ひらがなをストロークに変換する方法を考える必要があります。

指標の具体的な計算方法については、genkeyとoxeylyzerを確認します。
