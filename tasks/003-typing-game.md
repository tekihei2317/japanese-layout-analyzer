# タイピング画面の作成

画面の詳細については[設計](../docs/design.md)を参照。

## タスク一覧

- [x] 各配列のローマ字テーブルを用意する
  - まずはQwerty、月配列、月林檎配列などいくつかの配列を用意して検証します。
  - [x] Qwerty
  - [ ] 大西配列
  - [ ] 花配列
  - [x] 月配列2-263式
  - [ ] 幸花配列
  - [ ] ミズナラ配列
  - [ ] ハイブリッド月配列
  - [x] ぶな配列
  - [ ] 中指シフト月光
  - [ ] 英月配列
  - [ ] 月見草配列
  - [x] 月林檎配列
  - [x] ブリ中トロ配列
  - [ ] 月見草エキス配列
  - [ ] 文月配列
- [x] キー入力をローマ字テーブルを元にかなに変換するロジックを書く
- [x] お題とワードの一覧を作成する
  - 最初はお題は1つだけでいいです。また後から追加していきます。
- [x] タイピングの入力の正誤判定ロジックを実装する。
- [x] 変換ロジックのバグ修正
- [x] 複数ワードに対応する
- [x] ESCで最初からやり直せるようにする
- タイピング結果画面を作成する。スコア、kpm、cpmなどを表示する。→また今度

### 配列の追加

ローマ字テーブルの追加と、配列の説明の追加が必要です。

まずは、配列の追加をできるようにしましょう。

月見草配列と月見草エキス配列は複雑なので、後回しにします。

- [x] Qwerty
- [x] 大西配列
- [x] 花配列
- [x] 月配列2-263式
- [x] 幸花配列
- [x] ミズナラ配列
- [x] ハイブリッド月配列
- [x] ぶな配列
- [x] 英月配列
- [ ] 月見草配列
- [x] 月林檎配列
- [x] ブリ中トロ配列
- [ ] 月見草エキス配列
- [ ] 文月配列

## メモ

英月配列はZennとTwitterから。2025年12月時点で最新版のv4.1（2019年6月発表）を使うことにする。

https://x.com/madeinwariofan/status/1147041872583331842

https://zenn.dev/bantako/scraps/f0744cac168cb0

ハイブリッド月配列は昔書いたやつがあったのでそのまま使ってみる。外来音は未確認。「ぢ」「づ」が抜けていたので追加する。

https://github.com/tekihei2317/typing-keyboard-layout-wiki/blob/c90fdd069aef5eca48679c90a24f2ecb7024d885/layouts/hybrid-tsuki.tsv

ミズナラ配列の配列図は以下を参照した。styファイルがあるのでtsvに手動変換。長音のところが変なカッコになってたのでそこだけ変更した。

http://keybor.web.fc2.com/mizunara-v1.0.html

---

タイピングゲームの状態の設計について。

./typing-game-one-hour/src/hooks/use-typing-game.ts を参考にする。

まず、アプリケーションが取りうる状態を表現する。

考慮することを書き出す。

- 選べるのはワード、出題数、配列の3つ
- 配列が変わったら、入力の変換ロジックが変わる
- spaceキーを押してスタートする
- ワードとワードの間のインターバルは0.5秒
- ひらがなを、正解しているところまでは緑色、間違っているところは赤色にする
  - 未確定のストロークについては、間違いにしない
- 全てのワードを打ち終わったら「終了」画面にする

---

花配列でこういう設定ファイルを書いているんだけど、mozcが想定と違う挙動をしているから悩んでいる。

```tsv
は☆g	ぱ
ひ☆g	ぴ
ふ☆g	ぷ
へ☆g	ぺ
ほ☆g	ぽ
```

バッファ+新しい文字に対する変換ルールが存在しなかったときは、length-1文字と1文字に分けると思ってたんだけど、そうじゃないみたい。

例えば、

は☆g=ぱになるんだけど、は☆t=は / ☆t=はへ、と、区切る場所が違う。
