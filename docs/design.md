# 設計

日本語の配列の定量評価データを確認したり、配列を体験できるサイトを作成する。

また、定量評価データを計算するためのCLIツールを作成する。

## 目的

- 日本語の順次打鍵の配列について、
  - ヒートマップ、行の負荷、列の負荷などを確認できる
  - 英語新配列の定量評価で使われる指標（SFBs、SFSs、Scissors、Alt、Rolls、Redirect等）を一覧で確認できる
- さまざまな配列とコーパスの組み合わせで確認できる
- 日本語の順次打鍵の配列を体験できる

## 要件など

全てのコーパスと配列の組み合わせについて、データはあらかじめ計算しておきます。

サーバーサイドとのやりとりはないので、全てのページを事前に静的レンダリングしておきます。

ページは3つあります。データを配列図と一緒に分かりやすく表示するページ、データだけを表形式で表示するページ、タイピングページの3つです。

### データを分かりやすく表示するページ

Keyboard Layout Statsを簡略化するイメージです。

![Keyboard Layout Stats](https://i.gyazo.com/04c8db1e98ee5d7f2d8c2cf7e7d9df4e.png)

主に配列図（簡易的なもの）、負担率、指標の3つのセクションがあります。

配列図: 難しくないので一旦省略。

負担率: ブリ中トロ配列の表示方法が分かりやすいので、参考にします。

![ブリ中トロ配列の負担率の画像](https://i.gyazo.com/65de8344211b56a5ddcccf7c6711ab58.png)

指標: Same Finger Bigrams、Skip Bigrams、Scissors、Trigram Stats（Alt、Rolls、Redir）のそれぞれについて、パーセントを表示するだけで良いです。これは、keyboard layout docsの指標を表示している部分のイメージ。しきい値はまた考えましょう。

![keyboard layout docs](https://i.gyazo.com/30cb57b6490a25c7508b68943d77ce2f.png)

### データだけを表形式で表示するページ

![Keyboard Layout Stats / table](https://i.gyazo.com/d47f6f8b9f6c5ab44ce7ac94fc95e540.png)

Keyboard Layout Statsのようなイメージです。表示する指標は前述のページのものだけでOK。また、ヘッダー行クリックでソートできるようにします。

### タイピングページ

```text
ワード: [オリジナル] 出題数: [5]

日本で一番高い山は富士山だ ←ワード表示
にほんでいちばんたかいやまはふじさんだ ← ひらがな表示
にほんでいちばんt ← 入力中の文字

配列: [QWERTY]

（ここに配列図や、配列の説明、リンクなどを入れる）
```

ワード、問題の出題数、配列を選べるようにします。

入力、判定のロジックについては、Google日本語入力のローマ字テーブルを使います。打鍵した文字をローマ字テーブルのルールにしたがって変換していき、ひらがな表示と一致すればOK、というような判定です。また、Backspaceも受け付けます。

## その他注意事項

決める必要があるもの。

- 使う配列。
  - ローマ字入力ではQWERTY配列と大西配列。
  - かな入力では、花配列、月配列2-263式、幸花配列、ミズナラ配列、ハイブリッド月配列、ぶな配列、中指シフト月光
  - 英月配列、月見草配列、月林檎配列、ブリ中トロ配列、月見草エキス配列、文月配列
- コーパスのフォーマット。
  - モーラ単位の2-gramと3-gramのデータがあればいいのかなと思っています。
- 配列の評価に使う指標と、それらをコーパスからどのように計算するか。

CLIツールについては、とりあえずコーパスと配列の組み合わせから、データを計算して表示するコマンド（`analyze`）だけあればいいかなと思います。

あとは、オプション（`---json`）を追加してJSON形式で表示して、それをサイトで読み込む形にしたいです。

## 参考にするもの

- [Keyboard Layout Stats](https://cyanophage.github.io/)
- [semilin/genkey: The layout analyzer and generator used to create Semimak](https://github.com/semilin/genkey)
- [o-x-e-y/oxeylyzer](https://github.com/o-x-e-y/oxeylyzer)
